<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eGallon</title>

    <!-- Odometer -->
    <link rel="stylesheet" href="odometer-theme-car.css"/>
    
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css"/>
</head>

<body>
    <header>
        <img src="gridlogo.png" alt="GRID Logo">
    </header>

    <h2 class="roboto-light-grid-typing" id="headline">What does a gallon of electricty cost?</h2>
    <h2 class="roboto-regular">The eGallon</h2>
    <h2 class="roboto-light-grid" id="headline">Compare the Costs of Driving with Electricity</h2>

    <!-- Loading Indicator -->
    <div id="loading">
        <div class="spinner"></div>
    </div>

    <div class="container" id="odometerContainer" style="display: none;">
        <div id="Gasoline-Container">
            <div id="odometerGas" class="odometer">0.00</div>
            <h4 class="roboto-light">CA regular gasoline ($/gallon)</h4>
        </div>
        <div id="Electric-Container">
            <div id="odometerElectric" class="odometer">0.00</div>
            <h4 class="roboto-light">electric eGallon</h4>
        </div>
    </div>

  <footer>
    <ul class="footer-list">
        <li class="footer-item roboto-regular">
            <strong>What is an eGallon?</strong> It is the cost of fueling a vehicle with electricity compared to a similar vehicle that runs on gasoline.
        </li>
        <li class="footer-item roboto-regular">
            The eGallon was first conceived by the Department of Energy. Learn more about the eGallon methodology at 
            <a href="https://www.energy.gov/articles/egallon-methodology" target="_blank">https://www.energy.gov/articles/egallon-methodology</a>.
        </li>
        <li class="footer-item roboto-regular">
            This tool provides an estimate of potential savings, with actual results varying based on several factors. Data is sourced from the U.S. Energy Information Administration and rates change periodically. 
        </li>
    </ul>
</footer>

    <script src="odometer.js"></script>
    <script>
        const odometerGas = new Odometer({ el: document.getElementById('odometerGas') });
        const odometerElectric = new Odometer({ el: document.getElementById('odometerElectric') });

        // Update odometer with default values (fallback if API call fails)
        odometerGas.update(0.00);
        odometerElectric.update(0.00);

        const EIA_API_KEY = "ABFJ3GwbpgUCNVDoRZR2V7PXInOhoLjaEqKfbAaA"; 
        const GASOLINE_EFFICIENCY_MPG = 30; 
        const EV_EFFICIENCY_KWH_PER_100_MILES = 37; 

        async function getAverageGasolinePrice() {
            const url = `https://api.eia.gov/v2/petroleum/pri/gnd/data/?api_key=${EIA_API_KEY}&frequency=weekly&data[0]=value&facets[duoarea][]=SCA&sort[0][column]=period&sort[0][direction]=desc&offset=0&length=1`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.response.data[0].value; 
            } catch (error) {
                console.error("Failed to fetch gasoline prices:", error);
                return null;
            }
        }

        async function getAverageElectricityPrice() {
            const url = `https://api.eia.gov/v2/electricity/retail-sales/data/?api_key=${EIA_API_KEY}&frequency=monthly&data[0]=price&facets[sectorid][]=RES&facets[stateid][]=CA&sort[0][column]=period&sort[0][direction]=desc&offset=0&length=1`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.response.data[0].price / 100; 
            } catch (error) {
                console.error("Failed to fetch electricity prices:", error);
                return null;
            }
        }

        async function calculateEGallon() {
            const gasolinePrice = await getAverageGasolinePrice();
            const electricityPrice = await getAverageElectricityPrice();

            document.getElementById('loading').style.display = 'none'; 
            document.getElementById('odometerContainer').style.display = 'flex'; 

            if (gasolinePrice !== null && electricityPrice !== null) {
                odometerGas.update(gasolinePrice);
                const eGallon = (electricityPrice * EV_EFFICIENCY_KWH_PER_100_MILES) / GASOLINE_EFFICIENCY_MPG;
                odometerElectric.update(eGallon.toFixed(2)); 
                console.log(`The eGallon cost is: $${eGallon.toFixed(2)}`);
                typeHeadline("What does a gallon of electricty cost?", 55); 
            } else {
                console.log("Failed to retrieve data for eGallon calculation.");
            }
        }

        function typeHeadline(text, delay) {
    const headlineElement = document.getElementById('headline');
    headlineElement.textContent = ""; 
    let index = 0;

    function type() {
        if (index < text.length) {
            headlineElement.textContent += text.charAt(index); 
            index++;
            setTimeout(type, delay); 
        } else {
            // Remove the cursor by changing the CSS property to 'none'
            headlineElement.style.borderRight = "none"; 
        }
    }

    type(); 
}


        calculateEGallon();
    </script>
</body>
</html>
